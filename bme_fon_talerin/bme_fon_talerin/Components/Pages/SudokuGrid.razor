@page "/sudokuGrid"
@using System.Text.Json
@using bme_fon_talerin.Data
@using bme_fon_talerin.Data.Models
@using bme_fon_talerin.Models
@using Microsoft.EntityFrameworkCore
@attribute [StreamRendering]

@inject TalerinContext Context

<style>
    .sudokugrid {
        aspect-ratio: 1 / 1;
        height: min(75vh, 65vw);
        width: min(75vh, 65vw);
        display: grid;
        grid-template-columns: @GridLayout;
        background-color: black;
        border: solid black 5px;
        cursor: pointer;
        pointer-events: none;
    }
    .cell {
        aspect-ratio: 1 / 1;
        width: 100%;
        height: 100%;
        background-color: #f1f1f1;
        padding: 5px;
        border-color: black;
        border-width: 1px;
        border-style: solid;
        pointer-events: auto;
    }
    .cell:focus {
        outline: none;
    }
    .cell.borderright {
        border-right-width: 3px;
        padding-right: 3px;
    }
    .cell.borderleft {
        border-left-width: 3px;
        padding-left: 3px;
    }
    .cell.bordertop {
        border-top-width: 3px;
        padding-top: 3px;
    }
    .cell.borderbottom {
        border-bottom-width: 3px;
        padding-bottom: 3px;
    }
    .cellvalue {
        width: inherit;
        height: inherit;
        z-index: 3;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        font-size: 3rem;
    }
    .cellpencil {
        width: inherit;
        height: inherit;
        z-index: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        top: -100%;
    }
    .cellhighlight {
        width: -webkit-fill-available;
        height: -webkit-fill-available;
        z-index: 5;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        top: -200%;
        background-color: transparent;
        margin: -5px;
        border-style: inset;
        border-color: deepskyblue;
        border-width: 10px;
        opacity: 30%;
    }

    .cellpencildata {
        max-width: 5ch;
        font-size: 1rem;
        overflow-wrap: break-word;
        letter-spacing: 0.2rem;
        line-height: normal;
        text-align: center;
    }
</style>

<script>
    function select(highlighter)
    {
        var highlight = document.getElementById(highlighter)
        highlight.hidden = !highlight.hidden;
        // console.log(highlighter + " - " highlight.hidden);
    }
    function deselect(highlighter)
    {
        var highlight = document.getElementById(highlighter)
        highlight.hidden = true;
        // console.log(highlighter + " - " highlight.hidden);
    }
</script>

<PageTitle>SudokuGrid</PageTitle>

<p>Sudoku Grid</p>

<div class="sudokugrid">
    @for (var row = 0; row < SudokuData.Size; row++)
    {
        @for (var column = 0; column < SudokuData.Size; column++)
        {
            <SudokuCell Row="row" Column="column" Value="GivenCells[row][column]" GridType="@GridType" Rand="@Rand"></SudokuCell>
        }
    }
</div>

@code {

    private Sudoku SudokuData { get; set; }
    private string GridType { get; set; }

    private int?[][] GivenCells { get; set; }

    private string GridLayout { get; set; } = "";

    private Random Rand { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Rand = new Random();
        SudokuData = Context.Sudokus.First();
        var rule = Context.SudokuRules.Where(x => x.SudokuId == SudokuData.Id && x.Rule.Name == "Box").Include(x => x.Rule).Single();
        GridType = rule.Rule.Name;

        GivenCells = JsonSerializer.Deserialize<SudokuGridCells>(SudokuData.GivenCells).Cells;

        for (var size = 0; size < SudokuData.Size; size++)
        {
            GridLayout += " auto";
        }
    }
}